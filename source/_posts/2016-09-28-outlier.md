---
layout: post
title: 异常数据分析与处理
category: R
tags: [R, statistics]
notebook: 待处理
---

{% cq %}
生活是一种绵延不绝的渴望，渴望不断上升，变得更伟大而高贵。
          ———— 杜伽尔
{% endcq %}

<!-- more -->

## 1. 异常数据概述

异常数据是少量的、与众不同的，与大多数数据相比是有偏差的,而且产生这种偏差的原因不是随机的，而是有其更深层次的必然原因，它产生于完全不同的机制。为了从数据集中识别异常数据，就必须有一个明确的标准。这需要找到数据的内在规律，在一个可接受的误差范围内，满足内在规律的数据就是正常数据，而不满足内在规律的数据就是异常数据。

异常数据检测在很多实际的生产生活中都有着具体的应用，比如信用卡欺诈，工业损毁检测，图像检测等。

### 1.1 异常值

异常值是异常数据的一种，主要是指针对单一变量的异常数据。

### 1.2 离群点

离群点与异常值的主要区别在于，离群点指的是很多变量综合考虑之后的异常数据。在某些情况下，也用一元离群点指异常值。

### 1.3 异常数据之‘异常’

在一个可接受的误差范围内，满足内在规律的数据是正常数据，不满足内在规律的数据是异常数据。那么这些数据的内在规律是什么呢？

数据的内在规律可以根据数据本身的特点，从位置关系、函数关系、规则关系、序列关系等方面来考查。

#### 位置关系

大多数正常数据具有很大的相似性而符合一个共同模式，在空间上表现在一起的趋势，团结在一个或者多个核心的周围，而那些异常数据则表现得离群，他们总是离所有的核心都很远。

#### 函数关系

大多数数据都符合某个函数模型，因此数据点大多分布在函数曲线附近，而那些异常数据则距离曲线比较远。

#### 规则关系

如果数据集中某些符合某个规则条件，则称这些数据具有规则关系。

#### 序列关系

序列关系是指数据集中的某些数据满足某种序列模式，而那些相同条件下不满足序列模式的数据就是异常数据。

## 2. 异常值（一元离群点）的检测与处理

### 2.1 异常值（一元离群点）检测

#### 箱型图检测

 - 下四分位數(Q1)
 - 中位數(Med)
 - 上四分位數(Q3)
 - 四分位間距(interquartile range)= Q3-Q1

![boxplot](http://ocs218n9i.bkt.clouddn.com/boxplot.png)

在区间

 - 最大值： Q3+1.5(Q3-Q1)
 - 最小值： Q1-1.5(Q3-Q1)

外的值则视为离群点

#### 基于正态的检测

假设样品$(x_1, x_2, ... , x_i, ... , x_n)$服从正态分布，这些样品的均值$\mu$和方差$\sigma$分别为：
$$\mu = \sum_(i=1)^n \frac{x_i}{n_i}$$
$$\sigma^2 = \sum_(i=1)^n \frac{(x_i - \mu)^2}{n}$$

在正态分布的假设下，区域 $\mu \pm 3\sigma$ 包含了99.7% 的数据，如果某个值距离分布的均值 $\mu$ 超过了 $3\sigma$，那么这个值就可以被简单的标记为一个一元离群点（outlier）。

### 2.2 异常值（一元离群点）处理

常见的异常值处理办法是删除法、替代法（连续变量均值替代、离散变量用众数以及中位数替代）、插补法（回归插补、多重插补）除了直接删除，可以先把异常值变成缺失值、然后进行后续缺失值补齐。

#### 盖帽法

#### 分箱法

将连续变量等级化之后，不同的分位数的数据就会变成不同的等级数据，连续变量离散化了，消除了极值的影响。

#### 均值替换

数据集分为缺失值、非缺失值两块内容。缺失值处理如果是连续变量，可以选择均值；离散变量，可以选择众数或者中位数。

#### 回归差补法

#### 多重差补法-mice包

多重插补的处理有两个要点：先删除Y变量的缺失值然后插补。

 1. 被解释变量有缺失值的观测不能填补，只能删除，不能自己乱补；
 2. 只对放入模型的解释变量进行插补。

## 3. 多元离群点的检测

涉及两个或者两个以上变量的数据称为多元数据，很多一元离群点的检测方法都可以扩展到高维空间中，从而处理多元数据。

### 3.1 多元离群点的检测

#### 多元高斯分布的异常点检测

#### 使用 Mahalanobis 距离检测多元离群点

#### 使用 $\chi^{2}$ 统计量检测多元离群点

#### 基于矩阵分解检测多元离群点

#### 基于Replicator Neural Networks (RNNs)检测多元离群点

## 4. 参考文献

 1. [http://blog.csdn.net/sinat_26917383/article/details/51210793](http://blog.csdn.net/sinat_26917383/article/details/51210793)
 2. [https://zr9558.com/2016/06/13/outlierdetectionone/](http://blog.csdn.net/sinat_26917383/article/details/51210793)

